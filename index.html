<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>3D Cube</title>
</head>

<body style="background-color:black; overflow: hidden">


    <canvas id="cnv" width="2000" height="2000" style="background-color:black; border:1px solid #ffffff;  position: absolute;
    z-index: 15;
    top: 50%;
    left: 50%;
    margin: -1000px 0 0 -1000px;
    cursor: none;">"></canvas>
    <script>

    var speed = 10;


    var Vertex = function(x, y, z) {
        this.x = parseFloat(x);
        this.y = parseFloat(y);
        this.z = parseFloat(z);
    };

    var Vertex2D = function(x, y) {
        this.x = parseFloat(x);
        this.y = parseFloat(y);
    };

    var Cube = function(center, side) {
                // Generate the vertices
                var d = side / 2;

                this.vertices = [
                new Vertex(center.x - d, center.y - d, center.z + d),
                new Vertex(center.x - d, center.y - d, center.z - d),
                new Vertex(center.x + d, center.y - d, center.z - d),
                new Vertex(center.x + d, center.y - d, center.z + d),
                new Vertex(center.x + d, center.y + d, center.z + d),
                new Vertex(center.x + d, center.y + d, center.z - d),
                new Vertex(center.x - d, center.y + d, center.z - d),
                new Vertex(center.x - d, center.y + d, center.z + d)
                ];

                // Generate the faces
                this.faces = [
                [this.vertices[0], this.vertices[1], this.vertices[2], this.vertices[3]],
                [this.vertices[3], this.vertices[2], this.vertices[5], this.vertices[4]],
                [this.vertices[4], this.vertices[5], this.vertices[6], this.vertices[7]],
                [this.vertices[7], this.vertices[6], this.vertices[1], this.vertices[0]],
                [this.vertices[7], this.vertices[0], this.vertices[3], this.vertices[4]],
                [this.vertices[1], this.vertices[6], this.vertices[5], this.vertices[2]]
                ];
            };

            var Particles = []

            var Particle = function(center, side) {
                        // Generate the vertices
                        var d = side / 2;

                        this.vertices = [
                        new Vertex(center.x - d, center.y - d, center.z + d),
                        ];

                    };

                    function project(M) {
                // Distance between the camera and the plane
                var d = 500;
                var r = d / M.y;

                return new Vertex2D(r * M.x, r * M.z);
            }
            var color = 0;
            var color2 = 255;
            var faces = true;
            function render(objects, ctx, dx, dy) {

                // Clear the previous frame
                ctx.clearRect(0, 0, 2*dx, 2*dy);


                if(faces == true)
                {
                   // For each object
                   for (var i = 0, n_obj = objects.length; i < n_obj; ++i) {

                       // For each face
                       for (var j = 0, n_faces = objects[i].faces.length; j < n_faces; ++j) {
                         if(objects[i].vertices[j].y > 90 &&  objects[i].vertices[j].y < 10000)
                            //
                        {
                           // Current face
                           var face = objects[i].faces[j];

                           // Draw the first vertex
                           var P = project(face[0]);
                           ctx.beginPath();
                           ctx.moveTo(P.x + dx, -P.y + dy);

                           // Draw the other vertices
                           for (var k = 1, n_vertices = face.length; k < n_vertices; ++k) {
                             P = project(face[k]);
                             ctx.lineTo(P.x + dx, -P.y + dy);
                         }

                           // Close the path and draw the face
                           ctx.closePath();


                           ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                           ctx.stroke();
                           //ctx.fillStyle = 'rgba(100, ' + color2 + ', ' + color + ', 0.3)';
                           ctx.fillStyle = 'rgba(' + color2 + ',100,100,0.3)';
                           ctx.fill();
                       }
                       
                       
                   }

                   color += 1;

                   color2 -= 1;


               } 
           }
           else
           {
                        // For each object
                        for (var i = 0, n_obj = objects.length; i < n_obj; ++i) {
                            // For each face
                            for (var j = 0, n_faces = objects[i].vertices.length; j < n_faces; ++j) {

                                if(objects[i].vertices[j].y > 90  &&  objects[i].vertices[j].y < 2000)
                                {
                                    var P = project(objects[i].vertices[j]);
                                    ctx.beginPath();
                                    ctx.arc(P.x + dx,-P.y + dy,1,0,2*Math.PI);
                                    ctx.stroke();
                                    ctx.fillStyle = "green";
                                    ctx.fill();
                                }
                            }
                        }
                    }
                    color = 0;
                    color2 = 255;

                    // For each object
                    for (var i = 0, n_obj = Particles.length; i < n_obj; ++i) {
                        // For each face
                        for (var j = 0, n_faces = Particles[i].vertices.length; j < n_faces; ++j) {

                            if(Particles[i].vertices[j].y > 90  &&  Particles[i].vertices[j].y < 1000)
                            {
                                var P = project(Particles[i].vertices[j]);
                                ctx.beginPath();
                                ctx.arc(P.x + dx,-P.y + dy,1,0,2*Math.PI);
                                //ctx.stroke();
                                ctx.fillStyle = 'rgba(' + color2 + ',100,100,0.3)';
                                //ctx.fillStyle = 'rgba(255,255,255,0.5)';
                                ctx.fill();
                            }
                            color += 1;

                            color2 -= 1;
                        }
                    }
                    color = 0;
                    color2 = 255;
                }





                (function() {
                // Fix the canvas width and height
                var canvas = document.getElementById('cnv');
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                var dx = canvas.width / 2;
                var dy = canvas.height / 2;

                // Objects style
                var ctx = canvas.getContext('2d');
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillStyle = 'rgba(0, 150, 255, 0.3)';

                // Create the cube
                var cube_center = new Vertex(0, 500, 0);
                var cube = new Cube(cube_center, dy);
                var objects = [];
                var cudesize = 30;

                function getRndInteger(min, max) {
                  return Math.floor(Math.random() * (max - min + 1) ) + min;
              }

              function CubeMaker()
              {
                for(var x = -cudesize; x <= cudesize; x++)
                {
                    for(var y = -cudesize; y <= cudesize; y++)
                    {
                            //objects.push(new Cube(new Vertex(x * 50, 250, y * 50), 50));
                        }
                    }

                    for(var x = -cudesize; x <= cudesize; x++)
                    {
                        for(var y = -cudesize; y <= cudesize; y++)
                        {
                            Particles.push(new Particle(new Vertex(getRndInteger(-1000,1000), getRndInteger(-1000,1000), getRndInteger(-1000,1000)), 50));
                        }
                    }

                    for(var x = -cudesize; x <= cudesize; x++)
                    {
                        for(var y = -cudesize; y <= cudesize; y++)
                        {
                            //objects.push(new Cube(new Vertex(-300, x * 50, y * 50), 50));
                        }
                    }

                    for(var x = -10; x <= 10; x++)
                    {
                        for(var y = -10; y <= 10; y++)
                        {
                          //  Particles.push(new Particle(new Vertex(x * 10,1000 , y * 10), 100));
                      }
                  }


                  for(var x = -10; x <= 10; x++)
                  {
                     for(var y = -10; y <= 10; y++)
                     {
                        objects.push(new Cube(new Vertex(y * 50, x * 50, -100), 50));
                    }
                }

                for(var x = -100; x <= 100; x++)
                {
                       //objects.push(new Cube(new Vertex(0, x * 50, -100), 50));
                   }

                   for(var x = -5; x <= 10; x++)
                   {


                       // objects.push(new Cube(new Vertex(getRndInteger(-1000,1000), getRndInteger(10,1), getRndInteger(1,1)), 50));

                   }

               }


               CubeMaker();
                // First render
                render(objects, ctx, dx, dy);

                // Events
                var mousedown = false;
                var mx = 0;
                var my = 0;

                canvas.addEventListener('mousedown', initMove);
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', stopMove);

                // Rotate a vertice
                function rotate(M, center, theta, phi) {
                    // Rotation matrix coefficients
                    var ct = Math.cos(theta);
                    var st = Math.sin(theta);
                    var cp = Math.cos(phi);
                    var sp = Math.sin(phi);

                    // Rotation
                    var x = M.x - center.x;
                    var y = M.y - center.y;
                    var z = M.z - center.z;

                    M.x = ct * x - st * cp * y + st * sp * z + center.x;
                    M.y = st * x + ct * cp * y - ct * sp * z + center.y;
                    M.z = sp * y + cp * z + center.z;
                }

                var rotation = 0;

                // Rotate a vertice
                function rotateX(point, radians) {
                    var y = point.y;
                    point.y = (y * Math.cos(radians)) + (point.z * Math.sin(radians) * -1.0);
                    point.z = (y * Math.sin(radians)) + (point.z * Math.cos(radians));
                }

                // Utility method to rotate point by Y in a 3D space
                function rotateY(point, radians) {
                    var x = point.x;
                    point.x = (x * Math.cos(radians)) + (point.z * Math.sin(radians) * -1.0);
                    point.z = (x * Math.sin(radians)) + (point.z * Math.cos(radians));
                }

                // Utility method to rotate point by Z in a 3D space
                function rotateZ(point, radians) {
                    var x = point.x;
                    point.x = (x * Math.cos(radians)) + (point.y * Math.sin(radians) * -1.0);
                    point.y = (x * Math.sin(radians)) + (point.y * Math.cos(radians));
                }

                // Initialize the movement
                function initMove(evt) {
                    //clearTimeout(autorotate_timeout);
                    mousedown = true;
                    mx = evt.clientX;
                    my = evt.clientY;
                }


                mxnew = 400;
                mynew = 400;
                var moveleft = false;

                var moveright = false;

                function move(evt) {

                    if (mousedown) {

                        mx = evt.clientX;
                        my = evt.clientY;

                        if(mxnew > mx)
                        {
                            rotation -= Math.PI/90;
                            for (var i = 0; i < objects.length; ++i)
                            {
                                for (var j = 0; j < objects[i].vertices.length; ++j)
                                {
                                    var p = objects[i].vertices[j];

                                    rotateZ(p, rotation);

                                }
                            }

                            for (var i = 0; i < Particles.length; ++i)
                            {
                                for (var j = 0; j < Particles[i].vertices.length; ++j)
                                {
                                    var p = Particles[i].vertices[j];

                                    rotateZ(p, rotation);

                                }
                            }


                            render(objects, ctx, dx, dy);

                            rotation = 0;
                        }

                        if(mx < 1)
                        {
                            //moveleft = true;
                        }
                        else
                        {
                            //moveleft = false;
                        }

                        if(mx > 1500)
                        {
                            //moveright = true;
                        }
                        else
                        {
                            //moveright = false;
                        }

                        if(mxnew < mx)
                        {
                            rotation += Math.PI/90;
                            for (var i = 0; i < objects.length; ++i)
                            {
                                for (var j = 0; j < objects[i].vertices.length; ++j)
                                {
                                    var p = objects[i].vertices[j];

                                    rotateZ(p, rotation);

                                }
                            }

                            for (var i = 0; i < Particles.length; ++i)
                            {
                                for (var j = 0; j < Particles[i].vertices.length; ++j)
                                {
                                    var p = Particles[i].vertices[j];

                                    rotateZ(p, rotation);

                                }
                            }

                            render(objects, ctx, dx, dy);

                            rotation = 0;
                        }

                        mxnew = mx;
                        

                        if(mynew < my)
                        {
                            rotation += Math.PI/90;
                            for (var i = 0; i < objects.length; ++i)
                            {
                                for (var j = 0; j < objects[i].vertices.length; ++j)
                                {
                                    var p = objects[i].vertices[j];

                                    rotateX(p, rotation);

                                }
                            }
                            for (var i = 0; i < Particles.length; ++i)
                            {
                                for (var j = 0; j < Particles[i].vertices.length; ++j)
                                {
                                    var p = Particles[i].vertices[j];

                                    rotateX(p, rotation);

                                }
                            }

                            render(objects, ctx, dx, dy);

                            rotation = 0;
                        }


                        if(mynew > my)
                        {
                            rotation -= Math.PI/90;
                            for (var i = 0; i < objects.length; ++i)
                            {
                                for (var j = 0; j < objects[i].vertices.length; ++j)
                                {
                                    var p = objects[i].vertices[j];

                                    rotateX(p, rotation);

                                }
                            }

                            for (var i = 0; i < Particles.length; ++i)
                            {
                                for (var j = 0; j < Particles[i].vertices.length; ++j)
                                {
                                    var p = Particles[i].vertices[j];

                                    rotateX(p, rotation);

                                }
                            }

                            render(objects, ctx, dx, dy);

                            rotation = 0;
                        }


                        mxnew = mx;
                        mynew = my;
                    }


                }

                function move1(evt) {
                    if (mousedown) {
                        var theta = (evt.clientX - mx) * Math.PI / 360;
                        var phi = (evt.clientY - my) * Math.PI / 180;

                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {   

                                rotate(objects[i].vertices[j], cube_center, theta, phi);
                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   

                                rotate(Particles[i].vertices[j], cube_center, theta, phi);
                            }
                        }

                        mx = evt.clientX;
                        my = evt.clientY;

                        render(objects, ctx, dx, dy);
                    }
                }


                function setImage(){

                    var now = Date.now();
                    var delta = now-then;

                    update(delta/1000);


                    then = now;

                    if(moveleft == true)
                    {

                        rotation -= Math.PI/90;
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                                var p = objects[i].vertices[j];

                                rotateZ(p, rotation);

                            }
                        }


                        render(objects, ctx, dx, dy);

                        rotation = 0;
                    }

                    if(moveright == true)
                    {

                        rotation += Math.PI/90;
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                                var p = objects[i].vertices[j];

                                rotateZ(p, rotation);

                            }
                        }


                        render(objects, ctx, dx, dy);

                        rotation = 0;
                    }

                    requestAnimationFrame(setImage);
                }

                var then = 0;

                var w = window;
                requestAnimationFrame = w.requestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame || w.mozRequestAnimationFrame;

                var keysDown = {};
                addEventListener("keydown", function(e){
                  keysDown[e.keyCode] = true;
                  e.preventDefault();
              }, false);
                addEventListener("keyup", function(e){
                  delete keysDown[e.keyCode];
                  e.preventDefault();
              }, false);

                function update(modifier){

                       //up
                       if(87 in keysDown){
                        for (var i = 0; i < objects.length; ++i) 
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j) 
                            {
                                objects[i].vertices[j].y -= speed;
                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   

                                Particles[i].vertices[j].y -= speed;
                            }
                        }

                        //cube_center.y -= speed;
                        render(objects, ctx, dx, dy);
                    }

                       //down
                       if(83 in keysDown){
                        for (var i = 0; i < objects.length; ++i) 
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j) 
                            {
                                objects[i].vertices[j].y += speed;
                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   

                                Particles[i].vertices[j].y += speed;
                            }
                        }

                        //cube_center.y += speed;
                        render(objects, ctx, dx, dy);
                    }

                       //left
                       if(65 in keysDown){

                        for (var i = 0; i < objects.length; ++i) 
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j) 
                            {
                                objects[i].vertices[j].x += speed;
                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   

                                Particles[i].vertices[j].x += speed;
                            }
                        }
                        //cube_center.x += speed;
                        render(objects, ctx, dx, dy);
                    }
                       //right
                       if(68 in keysDown){ 
                        for (var i = 0; i < objects.length; ++i) 
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j) 
                            {
                                objects[i].vertices[j].x -= speed;

                                //rotate(objects[i].vertices[j], cube_center, Math.PI / 90, -Math.PI / 90);
                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   

                                Particles[i].vertices[j].x -= speed;
                            }
                        }

                        //cube_center.x -= speed;
                        render(objects, ctx, dx, dy);
                    } 


                    if(39 in keysDown){ 
                        rotation += Math.PI/90;
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                                var p = objects[i].vertices[j];

                                rotateZ(p, rotation);

                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   
                                var p = Particles[i].vertices[j];

                                rotateZ(p, rotation);
                            }
                        }


                        render(objects, ctx, dx, dy);
                        rotation = 0;
                    }

                    if(37 in keysDown){ 
                        rotation -= Math.PI/90;
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                                var p = objects[i].vertices[j];

                                rotateZ(p, rotation);

                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   
                                var p = Particles[i].vertices[j];

                                rotateZ(p, rotation);
                            }
                        }


                        render(objects, ctx, dx, dy);

                        rotation = 0;
                    }


                    if(38 in keysDown){ 
                        rotation -= Math.PI/90;
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                                var p = objects[i].vertices[j];

                                rotateX(p, rotation);

                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   
                                var p = Particles[i].vertices[j];

                                rotateX(p, rotation);
                            }
                        }
                        render(objects, ctx, dx, dy);
                        rotation = 0;
                    }

                    if(40 in keysDown){ 
                        rotation += Math.PI/90;
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                                var p = objects[i].vertices[j];

                                rotateX(p, rotation);

                            }
                        }

                        for (var i = 0; i < Particles.length; ++i)
                        {
                            for (var j = 0; j < Particles[i].vertices.length; ++j)
                            {   
                                var p = Particles[i].vertices[j];

                                rotateX(p, rotation);
                            }
                        }

                        render(objects, ctx, dx, dy);

                        rotation = 0;
                    }

                    if(32 in keysDown){ 

                        if(faces == true)
                        {
                           faces = false; 

                       }
                       else{
                        faces = true; 
                    }


                }

            }

            function displaywheel(e){
                        var evt=window.event || e //equalize event object
                        var delta=evt.detail? evt.detail*(-120) : evt.wheelDelta //check for detail first so Opera uses that instead of wheelDelta


                        if(delta == 120)
                        {
                            for (var i = 0; i < objects.length; ++i) 
                            {
                                for (var j = 0; j < objects[i].vertices.length; ++j) 
                                {
                                    objects[i].vertices[j].z -= speed;
                                }
                            }
                            //cube_center.z -= speed;
                            render(objects, ctx, dx, dy);
                        }
                        else
                        {
                            {
                                for (var i = 0; i < objects.length; ++i) 
                                {
                                    for (var j = 0; j < objects[i].vertices.length; ++j) 
                                    {
                                        objects[i].vertices[j].z += speed;
                                    }
                                }
                                //cube_center.z += speed;
                                render(objects, ctx, dx, dy);
                            }
                        }
                    }
                    

                    var mousewheelevt=(/Firefox/i.test(navigator.userAgent))? "DOMMouseScroll" : "mousewheel" //FF doesn't recognize mousewheel as of FF3.x

                    if (document.attachEvent) //if IE (and Opera depending on user setting)
                        document.attachEvent("on"+mousewheelevt, displaywheel)
                    else if (document.addEventListener) //WC3 browsers
                        document.addEventListener(mousewheelevt, displaywheel, false)



                    function stopMove() {
                        mousedown = false;
                        autorotate_timeout = setTimeout(autorotate, 2000);
                    }

                    var rot = 0;
                    function autorotate() {
                        for (var i = 0; i < objects.length; ++i)
                        {
                            for (var j = 0; j < objects[i].vertices.length; ++j)
                            {
                            //rotate(objects[i].vertices[j], cube_center, -Math.PI / 720, Math.PI / 720);

                            //var p = objects[i].vertices[j];
                            
                           // rotateX(p, rotation);



                       }
                   }
                    //rotation += Math.PI/90;
                    rot += Math.PI/90;
                    for (var i = 0; i < Particles.length; ++i)
                    {
                        for (var j = 0; j < Particles[i].vertices.length; ++j)
                        {   
                            var ran1 = getRndInteger(1,20);
                            if(ran1 == 1)
                            {
                                Particles[i].vertices[j].x -= 0.5;
                            }
                            if(ran1 == 2)
                            {
                                Particles[i].vertices[j].y -= 0.5;
                            }
                            if(ran1 == 3)
                            {
                                Particles[i].vertices[j].z -= 0.5;
                            }
                            if(ran1 == 4)
                            {
                                Particles[i].vertices[j].x += 0.5;
                            }
                            if(ran1 == 5)
                            {
                                Particles[i].vertices[j].y += 0.5;
                            }
                            if(ran1 == 6)
                            {
                                Particles[i].vertices[j].z += 0.5;
                            }
                            
                        }
                    }

                    //cube_center.x -= speed;
                    render(objects, ctx, dx, dy);
                    rot = 0;
                    render(objects, ctx, dx, dy);

                    autorotate_timeout = setTimeout(autorotate, 10);
                }
                autorotate_timeout = setTimeout(autorotate, 0);
                setImage();
            })();




            </script>

        </body>
        </html>
